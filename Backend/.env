
# Database Configuration
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=Admin@sumit90
DB_NAME=bulk_email

# Server Configuration
PORT=5000
NODE_ENV=development



-- =====================================================
-- EMAIL CAMPAIGN DATABASE - 5 TABLES (FIXED)
-- =====================================================

-- Drop tables in reverse order (child first, parent last)
DROP TABLE IF EXISTS Email_Queue;
DROP TABLE IF EXISTS Campaign_Schedule;
DROP TABLE IF EXISTS Campaign_Client;
DROP TABLE IF EXISTS Campaign;
DROP TABLE IF EXISTS Template;

# -- =====================================================
# -- TABLE 1: Template (No dependencies)
# -- =====================================================
# CREATE TABLE Template (
#     id INT AUTO_INCREMENT PRIMARY KEY,
#     name VARCHAR(255) NOT NULL UNIQUE,
#     subject VARCHAR(500) NOT NULL,
#     body_template TEXT NOT NULL,
#     is_active BOOLEAN DEFAULT TRUE,
#     created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
#     updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
#     INDEX idx_name (name)
# ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

# -- =====================================================
# -- TABLE 2: Campaign (No dependencies)
# -- =====================================================
# CREATE TABLE Campaign (
#     id INT AUTO_INCREMENT PRIMARY KEY,
#     campaign_name VARCHAR(255) NOT NULL,
#     start_date DATE NOT NULL,
#     end_date DATE NOT NULL,
#     total_clients INT NOT NULL DEFAULT 0,
#     csv_file_name VARCHAR(255) DEFAULT NULL,
#     csv_file_path VARCHAR(500) DEFAULT NULL,
#     status ENUM('draft','scheduled','active','completed','paused','cancelled') DEFAULT 'draft',
#     total_scheduled INT DEFAULT 0,
#     total_sent INT DEFAULT 0,
#     total_failed INT DEFAULT 0,
#     total_pending INT DEFAULT 0,
#     created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
#     updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
#     INDEX idx_status (status),
#     INDEX idx_dates (start_date, end_date),
#     CONSTRAINT chk_date_range CHECK (end_date >= start_date),
#     CONSTRAINT chk_max_5_days CHECK (DATEDIFF(end_date, start_date) <= 4)
# ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

# -- =====================================================
# -- TABLE 3: Campaign_Client (Depends on Campaign)
# -- =====================================================
# CREATE TABLE Campaign_Client (
#     id INT AUTO_INCREMENT PRIMARY KEY,
#     campaign_id INT NOT NULL,
#     csv_row_number INT NOT NULL,
#     client_name VARCHAR(255) NOT NULL,
#     client_email VARCHAR(255) NOT NULL,
#     company VARCHAR(255) DEFAULT NULL,
#     phone VARCHAR(50) DEFAULT NULL,
#     is_email_valid BOOLEAN DEFAULT TRUE,
#     created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
#     UNIQUE KEY unique_campaign_row (campaign_id, csv_row_number),
#     INDEX idx_campaign (campaign_id),
#     INDEX idx_email (client_email),
#     FOREIGN KEY (campaign_id) REFERENCES Campaign(id) ON DELETE CASCADE
# ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

# -- =====================================================
# -- TABLE 4: Campaign_Schedule (Depends on Campaign, Template)
# -- =====================================================
# CREATE TABLE Campaign_Schedule (
#     id INT AUTO_INCREMENT PRIMARY KEY,
#     campaign_id INT NOT NULL,
#     schedule_date DATE NOT NULL,
#     scheduled_time TIME DEFAULT '09:00:00',
#     template_id INT NOT NULL,
#     start_row INT NOT NULL,
#     end_row INT NOT NULL,
#     total_emails INT GENERATED ALWAYS AS (end_row - start_row + 1) STORED,
#     status ENUM('pending','processing','completed','failed','cancelled') DEFAULT 'pending',
#     started_at DATETIME DEFAULT NULL,
#     completed_at DATETIME DEFAULT NULL,
#     emails_sent INT DEFAULT 0,
#     emails_failed INT DEFAULT 0,
#     created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
#     updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
#     INDEX idx_campaign_date (campaign_id, schedule_date),
#     INDEX idx_status (status),
#     INDEX idx_template (template_id),
#     FOREIGN KEY (campaign_id) REFERENCES Campaign(id) ON DELETE CASCADE,
#     FOREIGN KEY (template_id) REFERENCES Template(id) ON DELETE RESTRICT,
#     CONSTRAINT chk_row_range CHECK (end_row >= start_row),
#     CONSTRAINT chk_positive_rows CHECK (start_row >= 1)
# ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

# -- =====================================================
# -- TABLE 5: Email_Queue (Depends on ALL above tables)
# -- =====================================================
# CREATE TABLE Email_Queue (
#     id INT AUTO_INCREMENT PRIMARY KEY,
#     campaign_id INT NOT NULL,
#     schedule_id INT NOT NULL,
#     client_id INT NOT NULL,
#     template_id INT NOT NULL,
#     client_name VARCHAR(255) NOT NULL,
#     client_email VARCHAR(255) NOT NULL,
#     subject VARCHAR(500) NOT NULL,
#     body_html TEXT NOT NULL,
#     body_text TEXT DEFAULT NULL,
#     status ENUM('pending','queued','sending','sent','failed','bounced','rejected') DEFAULT 'pending',
#     retry_count INT DEFAULT 0,
#     max_retries INT DEFAULT 3,
#     scheduled_at DATETIME NOT NULL,
#     sent_at DATETIME DEFAULT NULL,
#     error_message TEXT DEFAULT NULL,
#     error_code VARCHAR(50) DEFAULT NULL,
#     message_id VARCHAR(255) DEFAULT NULL,
#     created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
#     updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
#     INDEX idx_status (status),
#     INDEX idx_schedule (schedule_id),
#     INDEX idx_scheduled_at (scheduled_at),
#     INDEX idx_client_email (client_email),
#     INDEX idx_template (template_id),
#     FOREIGN KEY (campaign_id) REFERENCES Campaign(id) ON DELETE CASCADE,
#     FOREIGN KEY (schedule_id) REFERENCES Campaign_Schedule(id) ON DELETE CASCADE,
#     FOREIGN KEY (client_id) REFERENCES Campaign_Client(id) ON DELETE CASCADE,
#     FOREIGN KEY (template_id) REFERENCES Template(id) ON DELETE RESTRICT
# ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;